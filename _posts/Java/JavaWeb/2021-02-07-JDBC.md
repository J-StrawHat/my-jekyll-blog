---
title: 「JavaWeb学习笔记01」JDBC
author: JoyDee
categories: [Java, JavaWeb]
tags: [JavaWeb, MySQL]
date: 2021-02-04 23:51:00 +0800
math: true
---

# Chapter 1. JDBC

## 1.1 JDBC概述

Java 数据库连接，Java Database Connectivity （简称 JDBC），是一套面向对象的应用程序接口，指定了**统一**的访问各种类型数据库的标准接口。

JDBC是一种底层的API（Application Programming Interface，应用程序接口），是连接数据库和Java应用程序的纽带，因此我们在访问数据库时需要在业务逻辑层中嵌入SQL语句。

SQL语句是面向关系的，依赖于关系模型，所以通过JDBC技术访问数据库也是面向**关系**的。

JDBC技术主要是完成以下几个任务：

1. 与数据建立一个链接；
2. 向数据库发送SQL语句；
3. 处理从数据库返回的结果。

需要注意的是，JDBC并不能直接访问我们的数据库，必须依赖各个数据库厂商提供的JDBC驱动程序（jar包），我们可以使用这套接口（JDBC）编程，而真正执行代码是驱动 jar 包中的实现类。

## 1.2

+ jar 包下载[戳这](https://downloads.mysql.com/archives/c-j/)，此处选择 `Platform Independent`、`5.1.37`。

+ 将下载得到的压缩包中的 jar 包放到 项目一个目录中，并右键该目录选择  `Add as Library `

  <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210207172605.png"/>

  

  ```java
  package JoyDee.LearningJDBC;
  
  import java.sql.Connection;
  import java.sql.DriverManager;
  import java.sql.Statement;
  
  public class JDBCdemo {
      public static void main(String[] args) throws Exception {
          //1. 导入驱动jar包（略）
          //2. 注册驱动
          Class.forName("com.mysql.jdbc.Driver"); //固定格式
          //3. 获取数据库连接对象
          Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/db1", "root", "root");
          //4. 定义SQL语句
          String sqlstr = "UPDATE stu SET address = 'Changsha' WHERE id = 1";
          //5. 获取执行SQL语句的实例对象
          Statement stmt = conn.createStatement();
          //6. 执行SQL
          int res = stmt.executeUpdate(sqlstr);
          //7. 处理结果
          System.out.println(res);
          //8. 释放资源
          stmt.close();
          conn.close();
      }
  }
  ```

  运行代码后，运行结果：

  <img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210207180506.png" style="zoom:80%;" />

`DriverManager`：类（Class），驱动管理对象，其功能：

1. 注册驱动；
2. 获取数据库连接

`Connection`：数据库连接对象

`Statement`：执行SQL的对象

`ResultSet`：结果集对象

`PreparedStatement`：执行SQL的对象





```java
package JoyDee.LearningJDBC;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;

public class JDBCdemo {
    public static void main(String[] args) {
        Statement stmt = null;
        Connection conn = null;
        //1. 导入驱动jar包（略）

        try {
            //2. 注册驱动
            Class.forName("com.mysql.jdbc.Driver"); //反射技术：将字节码文件加载入内存

            //3. 获取数据库连接对象
            conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/db1", "root", "root");
            //4. 定义SQL语句
            String sqlstr = "INSERT INTO stu VALUES (null, 'Nami', 'London')";
            //5. 获取执行SQL语句的实例对象
            stmt = conn.createStatement();
            //6. 执行SQL
            int cnt = stmt.executeUpdate(sqlstr);
            //7. 打印 影响的行数
            System.out.println(cnt);
            if(cnt > 0){
                System.out.println("添加成功!");
            }
            else {
                System.out.println("添加失败!");
            }

        } catch (ClassNotFoundException | SQLException e) {
            e.printStackTrace();
        } finally {
            //为避免空指针异常
            if(stmt != null){
                try{
                    stmt.close(); //先释放stmt(源自conn)
                } catch (SQLException e){
                    e.printStackTrace();
                }
            }

            if(conn != null){
                try{
                    conn.close();
                } catch (SQLException e){
                    e.printStackTrace();
                }
            }
        }
    }
}
```

<img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210207200104.png" style="zoom:80%;" />

DQL:

```java
package JoyDee.LearningJDBC;

import java.sql.*;

public class JDBCdemo {
    public static void main(String[] args) {
        Statement stmt = null;
        Connection conn = null;
        ResultSet res = null;
        //1. 导入驱动jar包（略）

        try {
            //2. 注册驱动
            Class.forName("com.mysql.jdbc.Driver"); //反射技术：将字节码文件加载入内存

            //3. 获取数据库连接对象
            conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/db1", "root", "root");
            //4. 定义SQL语句
            String sqlstr = "SELECT * FROM stu";
            //5. 获取执行SQL语句的实例对象
            stmt = conn.createStatement();
            //6. 执行SQL
            res = stmt.executeQuery(sqlstr);
            // 7. 处理结果
            if(res.next()){ //7.1 让游标下移一行的同时，判断是否有数据
                //7.2 获取数据
                int id = res.getInt(1);
                String name = res.getString("name");
                System.out.println(id + ":" + name + "\n");
            }
            
        } catch (ClassNotFoundException | SQLException e) {
            e.printStackTrace();
        } finally {
            //为避免空指针异常
            if(res != null){
                try{
                    res.close(); //先释放stmt(源自conn)
                } catch (SQLException e){
                    e.printStackTrace();
                }
            }

            if(stmt != null){
                try{
                    stmt.close(); //先释放stmt(源自conn)
                } catch (SQLException e){
                    e.printStackTrace();
                }
            }

            if(conn != null){
                try{
                    conn.close();
                } catch (SQLException e){
                    e.printStackTrace();
                }
            }
        }
    }
}
```

<img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210207203122.png" style="zoom:80%;" />



抽取工具类

`JDBCUtils.java` 文件：

```java
package JoyDee.utils;

import java.io.FileReader;
import java.io.IOException;
import java.net.URL;
import java.sql.*;
import java.util.Properties;

public class JDBCUtils {
    private static String url, user, password, driver; //只有静态的变量，才能被静态代码块访问
    //文件的读入，只需读入一次即可拿到相应值，使用静态代码块较为妥当
    static {
        try {
            Properties pro = new Properties(); //创建Properties这一属性类
            //加载文件
            ClassLoader classLoader = JDBCUtils.class.getClassLoader();
            //URL为统一资源定位符，从而定位到该配置文件的绝对路径
            URL resurl = classLoader.getResource("jdbc.properties");
            String path = resurl.getPath();
            pro.load(new FileReader(path));
            //获取属性值并赋值
            url = pro.getProperty("url");
            user = pro.getProperty("user");
            password = pro.getProperty("password");
            driver = pro.getProperty("driver");
            Class.forName(driver);
        } catch (IOException | ClassNotFoundException e) {
            e.printStackTrace();
        }
    }

    public static Connection getConnection() throws SQLException {
        return DriverManager.getConnection(url, user, password);
    }

    public static void close(Statement stmt, Connection conn){
        if(stmt != null){
            try{
                stmt.close();
            } catch (SQLException e){
                e.printStackTrace();
            }
        }
        // 注意，为保证两个对象能够正常关闭资源，两段try..catch不能合并。
        if(conn != null){
            try{
                conn.close();
            } catch (SQLException e){
                e.printStackTrace();
            }
        }
    }

    public static void close(ResultSet res, Statement stmt, Connection conn){
        if(res != null){
            try{
                res.close();
            } catch (SQLException e){
                e.printStackTrace();
            }
        }
        if(stmt != null){
            try{
                stmt.close();
            } catch (SQLException e){
                e.printStackTrace();
            }
        }
        // 注意，为保证两个对象能够正常关闭资源，两段try..catch不能合并。
        if(conn != null){
            try{
                conn.close();
            } catch (SQLException e){
                e.printStackTrace();
            }
        }
    }
}

```

`JDBCDemo.java`文件：（避免了“SQL注入”）

```java
package JoyDee.LearningJDBC;

import JoyDee.utils.JDBCUtils;
import java.sql.*;
import java.util.Scanner;

public class JDBCLogin {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in); //键盘录入信息
        System.out.println("请输入您要登陆的用户名:");
        String username = sc.nextLine();
        System.out.println("请输入您的密码:");
        String password = sc.nextLine();
        boolean flag = new JDBCLogin().login(username, password);
        if(flag) System.out.println("登陆成功!");
        else System.out.println("用户名或密码错误!");
    }
    public boolean login(String username, String password){
        if(username == null || password == null){
            return false;
        }
        Connection conn = null;
        PreparedStatement pstmt = null; //改为Statement的子类
        ResultSet res = null;
        try{
            conn = JDBCUtils.getConnection();
            String sqlstr = "SELECT * FROM userlist WHERE username = ? AND password = ?";
            pstmt = conn.prepareStatement(sqlstr); //传入SQL语句字符串
            pstmt.setString(1, username); //传递该方法的传入参数
            pstmt.setString(2, password);
            res = pstmt.executeQuery(); //无需再传入参数!
            return res.next();
        } catch (SQLException e){
            e.printStackTrace();
        } finally {
            JDBCUtils.close(res, pstmt, conn);
        }
        return false;
    }
}

```

`jdbc.properties`文件：

```
url = jdbc:mysql:///db1
user = root
password = root
driver = com.mysql.jdbc.Driver
```

<img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210207233620.png"/>

<img src="https://gitee.com/j__strawhat/MyImages/raw/master/20210207233731.png"/>